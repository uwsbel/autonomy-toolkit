<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="Writing an .atk.yml File" href="../writing-an-atk-yml-file/README.html" /><link rel="prev" title="Tutorials" href="../index.html" />

    <link rel="shortcut icon" href="../../_static/cropped-SBEL-32x32.png"/><meta name="generator" content="sphinx-3.4.2, furo 2020.12.30.beta24"/>
        <title>Using the ATK Development Environment - Autonomous Vehicle Toolbox 0.0.52 documentation</title>
      <link rel="stylesheet" href="../../_static/styles/furo.css?digest=33d2fc4f3f180ec1ffc6524e273e21d7d58cbe49">
    <link rel="stylesheet" href="../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f0f0f0;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" href="../../_static/styles/furo-extensions.css?digest=26485485040e7aaf717c13fd0188a5ad2c2deb60">
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script defer="defer" src="../../_static/jquery.js"></script>
    <script defer="defer" src="../../_static/underscore.js"></script>
    <script defer="defer" src="../../_static/doctools.js"></script>
    <script defer src="../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>

<div class="announcement">
  <aside class="announcement-content">
     
        <a style="text-decoration: none; color: white;" 
           href="https://sbel.wisc.edu">
           <img src="https://github.com/uwsbel/autonomy-toolkit/blob/master/docs/_static/cropped-SBEL-192x192.png?raw=true" 
                style="vertical-align: middle; display: inline; padding-right: 7.5px; height: 20px;"/>
           Checkout our website!
        </a>
     
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">Autonomous Vehicle Toolbox 0.0.52 documentation</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo only-light" src="../../_static/SBEL-light.png" alt="Light Logo"/>
    <img class="sidebar-logo only-dark" src="../../_static/SBEL-dark.png" alt="Dark Logo"/>
  </div>
  
  
</a><form class="sidebar-search-container" method="get" action="../../search.html">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../autonomy-research-testbed.html">Autonomy Research Testbed</a></li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Tutorials</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Using the ATK Development Environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../writing-an-atk-yml-file/README.html">Writing an <code class="docutils literal notranslate"><span class="pre">.atk.yml</span></code> File</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../usage/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../usage/cli.html">CLI Documentation</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../usage/api/autonomy_toolkit/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../usage/api/autonomy_toolkit/ros/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.ros</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../usage/api/autonomy_toolkit/ros/messages/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.ros.messages</span></code></a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../usage/api/autonomy_toolkit/utils/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.utils</span></code></a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../usage/api/autonomy_toolkit/utils/atk_config/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.utils.atk_config</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/api/autonomy_toolkit/utils/files/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.utils.files</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/api/autonomy_toolkit/utils/logger/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.utils.logger</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../../usage/api/autonomy_toolkit/utils/parsing/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.utils.parsing</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/api/autonomy_toolkit/db/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.db</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/api/autonomy_toolkit/dev/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.dev</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../../usage/api/autonomy_toolkit/run/index.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">autonomy_toolkit.run</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing.html">Contributing</a></li>
</ul>
<p><span class="caption-text">External Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://pypi.org/project/autonomy-toolkit/">PyPI</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/uwsbel/autonomy-toolkit">Github</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <section id="using-the-atk-development-environment">
<h1>Using the ATK Development Environment<a class="headerlink" href="#using-the-atk-development-environment" title="Permalink to this headline">¶</a></h1>
<p>The ATK development environment has been created to expedite the process from algorithm implementation to testing in simulation to deploying the control stack on the Autonomy Research Testbed (ART) (or any other compatible platform).</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>You have installed <code class="docutils literal notranslate"><span class="pre">autonomy-toolkit</span></code> (<a class="reference external" href="https://projects.sbel.org/autonomy-toolkit/setup.html">resources for that</a>)</p></li>
<li><p>You have cloned the <a class="reference external" href="https://github.com/uwsbel/autonomy-research-testbed">autonomy-research-testbed</a> repository</p></li>
</ul>
<p>This tutorial focuses on the Autonomy Research Testbed (ART) for description purposes. You will therefore need to have cloned the <a class="reference external" href="https://github.com/uwsbel/autonomy-research-testbed">autonomy-research-testbed</a> repository. ATK is not specific to ART, this is simply used to help explain the API.</p>
</section>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<p>Beyond installing the packages outlined in <a class="reference external" href="#prerequisites">prerequisites</a>, there is not much setup that is necessary. The <code class="docutils literal notranslate"><span class="pre">autonomy-toolkit</span></code> package provides tools for easily spinning up containers and attaching to the development environment within Docker.</p>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>To use the development environment, very convenient commands are provided through the <code class="docutils literal notranslate"><span class="pre">autonomy-toolkit</span></code> CLI. The documentation for the <code class="docutils literal notranslate"><span class="pre">dev</span></code> command can be found <a class="reference external" href="http://projects.sbel.org/autonomy-toolkit/usage/cli.html#dev">here</a>.</p>
<p>As described in the documentation, the <code class="docutils literal notranslate"><span class="pre">dev</span></code> command has five arguments: <code class="docutils literal notranslate"><span class="pre">build</span></code>, <code class="docutils literal notranslate"><span class="pre">up</span></code>, <code class="docutils literal notranslate"><span class="pre">down</span></code>, <code class="docutils literal notranslate"><span class="pre">attach</span></code>, and <code class="docutils literal notranslate"><span class="pre">run</span></code>. These may sound familiar if you’ve used <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code> before because the <code class="docutils literal notranslate"><span class="pre">dev</span></code> command essentially wraps <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code>. Everything that the <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span></code> command does, <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">compose</span></code> can also do; the <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span></code> cli command is simply made to expedite the process of entering a container and may also provide an easy mechanism to add additional functionality in the future.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For any commands mentioned herein, it will be assumed they are run from within the <code class="docutils literal notranslate"><span class="pre">autonomy-research-testbed</span></code> repository.</p>
</div>
<section id="entering-the-development-environment">
<h3>Entering the Development Environment<a class="headerlink" href="#entering-the-development-environment" title="Permalink to this headline">¶</a></h3>
<p>The first time you attempt to use the ART development environment, the docker image will need to be built (the <code class="docutils literal notranslate"><span class="pre">atk</span></code> package will do this for you). This may take upwards of 10 minutes, depending on the number of packages your control stack needs to install. After the initial build, you may never need to build the stack again (unless you need additional packages installed). To build the image the first time around, you can run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk dev
</pre></div>
</div>
<p>This is equivalent to running the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk dev --up --attach
</pre></div>
</div>
<p>And since the image has never been built, the <code class="docutils literal notranslate"><span class="pre">--up</span></code> argument will also build it. This is only the case if the image cannot be found, i.e. the first time you run <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span></code>.</p>
<p>If you make changes to the workspace and need additional packages to be installed into the container, you can run the same command with the build flag:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk dev --build
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is <em>not</em> equivalient to <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">--up</span> <span class="pre">--attach</span> <span class="pre">--build</span></code>. <code class="docutils literal notranslate"><span class="pre">--up</span></code> and <code class="docutils literal notranslate"><span class="pre">--attach</span></code> are only added if no other arguments are provided</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If the container is already running (i.e. <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">--up</span></code> has already been called), the new built image will not be loaded automatically. You need to tear down the container by running <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">--down</span></code> or <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">-d</span></code> and then spin up the container again with <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">--up</span></code>. This can be done with one command: <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span> <span class="pre">--down</span> <span class="pre">--up</span> <span class="pre">--build</span></code>.</p>
</div>
<p>After you run <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span></code>, you should see a shell prompt like the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ atk dev
WARNING  <span class="p">|</span> logger.set_verbosity :: Verbosity has been <span class="nb">set</span> to WARNING
art-dev:~/art/workspace$
</pre></div>
</div>
<p>For more information regarding the <code class="docutils literal notranslate"><span class="pre">atk</span></code> command, please see the <a class="reference external" href="https://projects.sbel.org/autonomy-toolkit/usage/cli.html#dev">documentation page</a>.</p>
</section>
<section id="developing-inside-the-container">
<h3>Developing Inside the Container<a class="headerlink" href="#developing-inside-the-container" title="Permalink to this headline">¶</a></h3>
<p>Once inside the container, if you type <code class="docutils literal notranslate"><span class="pre">pwd</span></code>, you should see <code class="docutils literal notranslate"><span class="pre">/home/art/art/workspace</span></code>. This is a mapped volume from the host. ART’s control stack is built on top of <a class="reference external" href="https://docs.ros.org/en/galactic/index.html">ROS 2</a>. The intracricies of ROS 2 and its usage is outside the scope of this tutorial. Please refer to their official documentation to learn more.</p>
<p>The important things to understand when it comes to the ROS 2 stack is that, by default, the <code class="docutils literal notranslate"><span class="pre">setup.bash</span></code> file in <code class="docutils literal notranslate"><span class="pre">~/art/workspace/install</span></code> will automatically be sourced by the shell profile script. If the workspace has not been built yet (i.e. <code class="docutils literal notranslate"><span class="pre">colcon</span> <span class="pre">build</span></code> has not been run), you will need to either source it yourself after the first build or exit and enter the container once more to rerun the shell profile script. Furthermore, for the most part, the <code class="docutils literal notranslate"><span class="pre">&lt;depend&gt;</span></code> flag in ROS 2 <code class="docutils literal notranslate"><span class="pre">package.xml</span></code> config files should be used to outline dependencies necessary to run the stack. This has already been done within the ART stack.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is <em>imperative</em> any changes to files are mode exclusively in <code class="docutils literal notranslate"><span class="pre">/home/art/art/</span></code>. This folder is a mapped Docker <a class="reference external" href="https://docs.docker.com/storage/volumes/">volume</a> and is shared with the host. If a file is editted outside of this folder, the changes will not persist once the container is torn down.</p>
</div>
<section id="running-a-simulation">
<h4>Running a Simulation<a class="headerlink" href="#running-a-simulation" title="Permalink to this headline">¶</a></h4>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To run the Chrono simulation with synthetic sensor data, a NVIDIA GPU is required.</p>
</div>
<p>Another container provided by the ART platform is <code class="docutils literal notranslate"><span class="pre">chrono</span></code>. The <code class="docutils literal notranslate"><span class="pre">chrono</span></code> container has been developed to provide a independent and prebuilt interface to the Chrono simulator. ART has been developed to have a Chrono model and various scenarios/examples are provided as a means of testing the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> container.</p>
<p>The ART stack also comes with a variety of launch packages/files, one of which is the <code class="docutils literal notranslate"><span class="pre">art_simulation.launch.py</span></code> file in the <code class="docutils literal notranslate"><span class="pre">art_simulation_launch</span></code> package. In this section, we’ll spin up a Chrono simulatiion using the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> container and then use <code class="docutils literal notranslate"><span class="pre">art_simulation.launch.py</span></code> to start up the control stack to control the simulated vehicle autonomously through a track of red and green cones. The interface between Chrono and ROS 2 has been implemented through the <a class="reference external" href="https://github.com/uwsbel/chrono-ros-bridge.git">chrono-ros-bridge</a>. This package is already provided in the ART workspace and the generated node is called upon in <code class="docutils literal notranslate"><span class="pre">art_simulation.launch.py</span></code>.</p>
<p>You first need to start the simulation. The Chrono simulation will act as a TCP server, so the ART launch file will throw errors if the Chrono sim is not started first. To do this, run the following command in one terminal window:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk dev --run --services chrono --gpus --args python demo_ARCLAB_cone.py
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">--services</span> <span class="pre">chrono</span></code> tells atk to use the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> container for the <code class="docutils literal notranslate"><span class="pre">--run</span></code> command. <code class="docutils literal notranslate"><span class="pre">--gpus</span></code> is required for the <code class="docutils literal notranslate"><span class="pre">demo_ARCLAB_cone.py</span></code> script because it uses <a class="reference external" href="https://api.projectchrono.org/group__sensor.html">Chrono::Sensor</a> which requires CUDA. Similar to the <code class="docutils literal notranslate"><span class="pre">dev</span></code> container with the <code class="docutils literal notranslate"><span class="pre">--up</span></code> flag, if the image for the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> container is not already built, <code class="docutils literal notranslate"><span class="pre">--run</span></code> will build it.</p>
<p>Then, in another terminal window, enter the development environment and run the following command to spin up both the <code class="docutils literal notranslate"><span class="pre">chrono-ros-bridge</span></code> node and the autonomy stack:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ atk dev --gpus <span class="c1"># NOTE: only use --gpus if you have a nvidia gpu</span>
WARNING  <span class="p">|</span> logger.set_verbosity :: Verbosity has been <span class="nb">set</span> to WARNING
art-dev:~/art/workspace$ ros2 launch art_simulation_launch art_simulation.launch.py hostname:<span class="o">=</span>art-chrono vis:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">vis:=true</span></code> flag essentially tells the stack nodes to visualize some intermediate steps that are currently implemented. <code class="docutils literal notranslate"><span class="pre">rviz2</span></code> is a better option for visualization purposes, and is automatically installed in the container. <code class="docutils literal notranslate"><span class="pre">rviz</span></code> configurations will be shipped with the repository in the near future. In any case, you may utilize the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container to then see the display windows. Details on the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container can be found <a class="reference external" href="#visualizing-gui-windows-with-vnc">here</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hostname:=art-chrono</span></code> tells the <code class="docutils literal notranslate"><span class="pre">chrono-ros-bridge</span></code> to connect to the server at the hostname <code class="docutils literal notranslate"><span class="pre">art-chrono</span></code>. If the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> instance is being run on a separate computer or is not at the <code class="docutils literal notranslate"><span class="pre">art-chrono</span></code> hostname, you can pass <em>instead</em> <code class="docutils literal notranslate"><span class="pre">ip:=&lt;ip</span> <span class="pre">address&gt;</span></code> where <code class="docutils literal notranslate"><span class="pre">&lt;ip</span> <span class="pre">address&gt;</span></code> is set to wherever the <code class="docutils literal notranslate"><span class="pre">chrono</span></code> server is actually running.</p>
</section>
<section id="running-with-a-ros-2-bag">
<h4>Running with a ROS 2 Bag<a class="headerlink" href="#running-with-a-ros-2-bag" title="Permalink to this headline">¶</a></h4>
<p>To facilitate the recording and replaying of data in a ROS 2 stack, bags can be created. The entrypoint <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">bag</span> <span class="pre">...</span></code> allows users to easily record/replay topics. For information on this command, please visit the <a class="reference external" href="https://docs.ros.org/en/galactic/Tutorials/Ros2bag/Recording-And-Playing-Back-Data.html">official ros documentation</a>. Using a ros2 bag to test a control stack is a viable option and is helpful to understand if code is working as expected.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">autonomy-research-testbed</span></code> is shipped with a ros2 bag for testing purposes. To see the file, you’ll need <a class="reference external" href="https://git-lfs.github.com/"><code class="docutils literal notranslate"><span class="pre">git-lfs</span></code></a>. <code class="docutils literal notranslate"><span class="pre">git-lfs</span></code> is used because the file is rather large.
Multiple ROS 2 bag files were recorded using ART for testing purposes. To get this file, you’ll need to download it from the Box folder. This can be done using the <a class="reference external" href="https://pypi.org/project/wget/"><code class="docutils literal notranslate"><span class="pre">wget</span></code></a> Python package and a custom entrypoint in <code class="docutils literal notranslate"><span class="pre">atk</span></code> called <code class="docutils literal notranslate"><span class="pre">db</span></code>. <code class="docutils literal notranslate"><span class="pre">db</span></code>, which stands for database, is an evolving tool and has not been fully implemented. Further documentation will be written in the near future.</p>
<p>You first need to pull the bag files. To do this, you may run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk db pull --use-atk-config
</pre></div>
</div>
<p>Under the hood, this is also reading the <code class="docutils literal notranslate"><span class="pre">.atk.yml</span></code> file to find the files that need to be pulled.</p>
<p>The folder will be located at <code class="docutils literal notranslate"><span class="pre">autonomy-research-testbed/demos/bags/ATK-&lt;ID&gt;/</span></code>. ROS 2 bags are contained in folders and the <code class="docutils literal notranslate"><span class="pre">ros2</span> <span class="pre">bag</span></code> command will be used to replay the file. After the file is pulled, enter the development environment and start replaying the bag file. We’ll have it loop so the stack can be visualized easier.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ atk dev --gpus <span class="c1"># NOTE: only use --gpus if you have a nvidia gpu</span>
WARNING  <span class="p">|</span> logger.set_verbosity :: Verbosity has been <span class="nb">set</span> to WARNING
art-dev:~/art/workspace$ ros2 bag play ../demos/bags/ATK-02-25-2022-03-19-00 -l <span class="c1"># or ATK-02-25-2022-04-30-30</span>
</pre></div>
</div>
<p>With the bag being played, open another terminal and start up the stack.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ atk dev --gpus <span class="c1"># NOTE: only use --gpus if you have a nvidia gpu</span>
WARNING  <span class="p">|</span> logger.set_verbosity :: Verbosity has been <span class="nb">set</span> to WARNING
art-dev:~/art/workspace$ ros2 launch art_launch art_stack.launch.py vis:<span class="o">=</span><span class="nb">true</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">vis:=true</span></code> flag essentially tells the stack nodes to visualize some intermediate steps that are currently implemented. <code class="docutils literal notranslate"><span class="pre">rviz2</span></code> is a better option for visualization purposes, and is automatically installed in the container. <code class="docutils literal notranslate"><span class="pre">rviz</span></code> configurations will be shipped with the repository in the near future. In any case, you may utilize the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container to then see the display windows. Details on the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container can be found <a class="reference external" href="#visualizing-gui-windows-with-vnc">here</a>.</p>
</section>
</section>
<section id="visualizing-gui-windows-with-vnc">
<h3>Visualizing GUI Windows with VNC<a class="headerlink" href="#visualizing-gui-windows-with-vnc" title="Permalink to this headline">¶</a></h3>
<p>Another container provided by <code class="docutils literal notranslate"><span class="pre">autonomy-toolkit</span></code> is <code class="docutils literal notranslate"><span class="pre">vnc</span></code>. It can be used to visualize GUI apps that otherwise would be difficult to do from within Docker. In theory, the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container supports either <a class="reference external" href="https://novnc.com/info.html">NoVNC</a> or a traditional VNC viewer, such as from <a class="reference external" href="https://www.realvnc.com/en/connect/download/viewer/">RealVNC</a>. In this section, we’ll focus on NoVNC since it doesn’t require any additional packages to be installed on the host.</p>
<p>By default, when you run <code class="docutils literal notranslate"><span class="pre">atk</span> <span class="pre">dev</span></code>, both the <code class="docutils literal notranslate"><span class="pre">dev</span></code> and <code class="docutils literal notranslate"><span class="pre">vnc</span></code> containers will be spun up. If you’d like to either start the <code class="docutils literal notranslate"><span class="pre">vnc</span></code> container explicitly or ensure it is in fact running, you can run the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>atk dev --up --services vnc
</pre></div>
</div>
<p>You can then navigate to <a class="reference external" href="http://localhost:8080">localhost:8080</a> to see the visualization windows. It should look something like the pictures below.</p>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/sim-novnc-screenshot.png?raw"><img alt="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/sim-novnc-screenshot.png?raw" src="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/sim-novnc-screenshot.png?raw" style="width: 49%;"/></a>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/real-novnc-screenshot.png?raw"><img alt="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/real-novnc-screenshot.png?raw" src="https://raw.githubusercontent.com/uwsbel/autonomy-toolkit/master/docs/tutorials/using-the-development-environment/images/real-novnc-screenshot.png?raw" style="width: 49%;"/></a>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a port conflict occurs (<a class="reference external" href="#port-conflicts">as described later</a>), you will need to replace <code class="docutils literal notranslate"><span class="pre">8080</span></code> in <a class="reference external" href="http://localhost:8080">localhost:8080</a> with whatever you remap the new port to.</p>
</div>
</section>
</section>
<section id="possible-problems">
<h2>Possible Problems<a class="headerlink" href="#possible-problems" title="Permalink to this headline">¶</a></h2>
<p>This sections outlines some possible pitfuls or frequently run into errors.</p>
<section id="port-conflicts">
<h3>Port Conflicts<a class="headerlink" href="#port-conflicts" title="Permalink to this headline">¶</a></h3>
<p>If a docker container attempts to map to a host port that is currently in use or otherwise unavailable, it will throw an error and exit. The <code class="docutils literal notranslate"><span class="pre">autonomy-toolkit</span></code> error for this looks similar to the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>CRITICAL <span class="p">|</span> dev._parse_ports :: Host port <span class="s1">'&lt;port&gt;'</span> is requested <span class="k">for</span> the <span class="s1">'&lt;service&gt;'</span> service, but it is already in use.
</pre></div>
</div>
<p>In this instance, <code class="docutils literal notranslate"><span class="pre">&lt;port&gt;</span></code> is requested to be mapped to the host for the service <code class="docutils literal notranslate"><span class="pre">&lt;service&gt;</span></code>, but it can’t happen because it’s already in use. The solution here is to use the <code class="docutils literal notranslate"><span class="pre">--port-mappings</span></code> flag. See below for usage:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ atk dev -s &lt;service&gt; --port-mappings &lt;old-port1&gt;:&lt;new-port1&gt; &lt;old-port2&gt;:&lt;new-port2&gt; --up
</pre></div>
</div>
<p>The syntax is as it appears above, where the <code class="docutils literal notranslate"><span class="pre">--port-mappings</span></code> argument takes any number of mappings such that it goes <code class="docutils literal notranslate"><span class="pre">&lt;old</span> <span class="pre">host</span> <span class="pre">port&gt;:&lt;new</span> <span class="pre">host</span> <span class="pre">port&gt;</span></code>.</p>
</section>
</section>
<section id="support">
<h2>Support<a class="headerlink" href="#support" title="Permalink to this headline">¶</a></h2>
<p>Contact the <a class="reference external" href="mailto:negrut%40wisc.edu">Simulation Based Engineering Laboratory</a> for any questions or concerns regarding the contents of this repository.</p>
</section>
<section id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p>Visit our website at <a class="reference external" href="https://sbel.wisc.edu">sbel.wisc.edu</a>!</p>
</section>
</section>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../writing-an-atk-yml-file/README.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Writing an <code class="docutils literal notranslate"><span class="pre">.atk.yml</span></code> File</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../index.html">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Tutorials</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2022, Simulation Based Engineering Laboratory
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/tutorials/using-the-development-environment/README.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Using the ATK Development Environment</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#setup">Setup</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#entering-the-development-environment">Entering the Development Environment</a></li>
<li><a class="reference internal" href="#developing-inside-the-container">Developing Inside the Container</a><ul>
<li><a class="reference internal" href="#running-a-simulation">Running a Simulation</a></li>
<li><a class="reference internal" href="#running-with-a-ros-2-bag">Running with a ROS 2 Bag</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visualizing-gui-windows-with-vnc">Visualizing GUI Windows with VNC</a></li>
</ul>
</li>
<li><a class="reference internal" href="#possible-problems">Possible Problems</a><ul>
<li><a class="reference internal" href="#port-conflicts">Port Conflicts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#support">Support</a></li>
<li><a class="reference internal" href="#see-also">See Also</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
  </body>
</html>